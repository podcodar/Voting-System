name: Deploy to Vercel

on: pull_request

jobs:
  # lint-and-test:
  #   runs-on: ubuntu-latest

  #   steps:
  #   - name: Checkout code
  #     uses: actions/checkout@v3

  #   - name: Set up Node.js
  #     uses: actions/setup-node@v3
  #     with:
  #       node-version: 20

  #   - name: Install dependencies
  #     run: yarn

  #   - name: Run lint
  #     run: yarn lint

    # - name: Run tests
    #   run: yarn test

  build-and-deploy:
    runs-on: ubuntu-latest
    environment: Production
    needs: lint-and-test

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Node
      uses: actions/setup-node@v3
      with:
        node-version: 20

    - name: Install dependencies
      run: echo ${{ secrets.DATABASE_URL }}
      
    - name: Install dependencies
      run: echo ${{ secrets.DATABASE_URL }} > .env

    - name: Install dependencies
      run: yarn
      
    - name: Run database migrations
      run: yarn migrate

    - name: Deploy to Vercel
      run: vercel --prod
      env:
        VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
